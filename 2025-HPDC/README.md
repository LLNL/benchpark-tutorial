# HPDC 2025 Tutorial

This directory contains the materials for the HPDC 2025 tutorial. The following subsections go over the contains of the material.

## Tutorial Code

The code elements of this tutorial (e.g., Jupyter notebooks, command-line scripts, Markdown/RST instruction files) can all be found in the `tutorial-code` subdirectory. If materials are actually stored in other git repositories, they can be accessed from this subdirectory
via a git submodule.

## Slides

The slides used in presenting this tutorial can be found in the `slides` subdirectory.

## Docker

The Docker definition files (i.e., Dockerfiles) for all the necessary containers can be found in the `docker` subdirectory. There are currently 5 definition files:
1. `Dockerfile.caliper`: builds Caliper and Adiak on top of the `ubuntu/noble` image from DockerHub
2. `Dockerfile.thicket`: build Thicket on top of the image produced by `Dockerfile.caliper`
3. `Dockerfile.benchpark`: download and bootstrap Benchpark on top of the image produced by `Dockerfile.benchpark`
4. `Dockerfile.spawn`: download tutorial materials, download any remaining necessary packages, and do other setup work on top of the image produced by `Dockerfile.benchpark`
5. `Dockerfile.init`: ensure user permissions are correct using the super-minimal `alpine/git` image from DockerHub

## Testing the Builds of the Docker Images

To enable automated testing of the Docker images, all edits to the Dockerfiles above should be done in a branch with an open PR. When a PR is open, a GitHub Actions CI will
run and ensure that the images can be built. To properly configure the CI, edit the `github_ci_matrix.json` file in the root of this repository as follows:
1. Edit the "tag" field to be the tag (i.e., version) of the Docker images you will be generating
2. Edit the "tutorial_dir" field to the name of this directory

The CI reads `github_ci_matrix.json` to get values shared by the matrices of all GitHub Actions jobs.

## Pushing the Docker Images to GitHub Container Registry (GHCR)

Before trying to push to GHCR, someone with the necessary permissions should make sure this repo can push to these images in GHCR (**change names when we decide on appropriate ones**):
* ghcr.io/LLNL/caliper
* ghcr.io/LLNL/thicket
* ghcr.io/LLNL/benchpark
* ghcr.io/LLNL/reproducible-benchmarking-spawn
* ghcr.io/LLNL/reproducible-benchmarking-init

If these images do not yet exist, your first push will properly set the permissions. If these images do exist, follow the instructions
[here](https://docs.github.com/en/packages/learn-github-packages/configuring-a-packages-access-control-and-visibility#ensuring-workflow-access-to-your-package)
to add this repository to each package. Make sure to grant "Write" permissions to the repository while doing this.

After ensuring this repository has the necessary permissions, to push the Docker images to GHCR, follow these steps:
1. Make sure all changes to the Dockerfiles have been merged into the `main` branch
2. From the GitHub webpage, navigate to the "Actions" tab
3. On the left of the resulting page, click on "Build containers and push to GHCR"
4. Click on the "Run workflow" button to the right of the page
5. In the popup menu that appears, select the "main" branch and fill out the requested information
6. Click the green "Run workflow" button to start the process and building and pushing images

## Infrastructure

All the infrastructure needed to deploy the tutorial to a Kubernetes cluster with JupyterHub is contained in the `infrastructure` subdirectory. This infrastructure is generated by the tool [here](https://lc.llnl.gov/gitlab/lumsden1/hpcic-k8s-configurer). The infrastructure can be regenerated as-is using `infrastructure/config.toml`.